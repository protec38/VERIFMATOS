{% extends "base.html" %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h4>Inventaire – Arbre</h4>
  <button class="btn btn-primary" data-bs-toggle="collapse" data-bs-target="#newNodeForm"><i class="fa-solid fa-plus me-1"></i>Nouveau noeud</button>
</div>
<div class="collapse mb-3" id="newNodeForm">
  <form class="card card-body" method="post" action="{{ url_for('inventory.create_node') }}">
    <div class="row g-2">
      <div class="col-md-4"><input class="form-control" name="name" placeholder="Nom" required></div>
      <div class="col-md-3"><input class="form-control" name="parent_id" placeholder="Parent ID (optionnel)"></div>
      <div class="col-md-2"><input class="form-control" name="expected_qty" placeholder="Qté (si feuille)"></div>
      <div class="col-md-2 d-flex align-items-center gap-2">
        <input class="form-check-input" type="checkbox" name="is_leaf" id="leaf">
        <label class="form-check-label" for="leaf">Feuille</label>
      </div>
      <div class="col-md-1"><button class="btn btn-success w-100">OK</button></div>
    </div>
  </form>
</div>

<div class="card shadow-sm rounded-4 p-3">
  {% macro render_node(n, depth=0) %}
    <div style="margin-left: {{ depth*18 }}px">
      <div class="d-flex align-items-center gap-2 py-1">
        {% if n.is_leaf %}
          <i class="fa-solid fa-square-check text-success"></i>
          <span>{{ n.name }} <small class="text-muted">x{{ n.expected_qty or '—' }}</small></span>
        {% else %}
          <i class="fa-solid fa-folder-tree text-primary"></i>
          <strong>{{ n.name }}</strong>
        {% endif %}
      </div>
    </div>
    {% for c in n.children|sort(attribute='position') %}
      {{ render_node(c, depth+1) }}
    {% endfor %}
  {% endmacro %}

  {% for r in roots %}
    {{ render_node(r, 0) }}
  {% endfor %}
</div>
{% endblock %}
