{% extends 'base.html' %}
{% block title %}Stock{% endblock %}
{% block content %}
<h1><i class="fa-solid fa-boxes-stacked"></i> Stock</h1>
<div class="grid">
  <div class="card">
    <h3><i class="fa-solid fa-plus"></i> Créer un objet</h3>
    <form method="post" action="{{ url_for('inventory.create_item') }}">
      <label>Nom</label><input name="name" required>
      <label>Objet parent ?</label><input type="checkbox" name="is_parent">
      <label>Code unique (optionnel)</label><input name="unique_code" placeholder="ex: SAC-PS-001">
      <label>Associer à un parent (pour enfants)</label>
      <select name="parent_id"><option value="">— aucun —</option>
        {% for p in items %}<option value="{{ p.id }}">{{ p.name }}</option>{% endfor %}
      </select>
      <label>Quantité attendue (pour enfants)</label><input name="expected_qty" type="number" min="1" value="1">
      <button type="submit"><i class="fa-solid fa-check"></i> Créer</button>
    </form>
  </div>
  <div class="card">
    <h3>Objets parents</h3>
    <ul class="list parents">
      {% for it in items %}
        <li class="parent"><strong><i class="fa-solid fa-briefcase-medical"></i> {{ it.name }}</strong> {% if it.unique_code %}<span class="tag">#{{ it.unique_code }}</span>{% endif %}
          <form class="inline" method="post" action="{{ url_for('inventory.delete_item', item_id=it.id) }}" onsubmit="return confirm('Supprimer ?');"><button type="submit"><i class="fa-solid fa-trash"></i></button></form>
          {% if it.children %}
          <ul>
            {% for c in it.children %}
              <li><i class="fa-solid fa-square-check"></i> {{ c.name }} <span class="muted">x{{ c.expected_qty }}</span> {% if c.unique_code %}<span class="tag">#{{ c.unique_code }}</span>{% endif %}</li>
            {% endfor %}
          </ul>
          {% else %}<div class="muted">Pas d'enfant.</div>{% endif %}
        </li>
      {% endfor %}
    </ul>
  </div>
</div>
{% endblock %}
