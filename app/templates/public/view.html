
{% extends "base.html" %}
{% block title %}Suivi public · Secouristes{% endblock %}
{% block content %}
<div class="mb-3">
  <h1 class="h4"><i class="fa-solid fa-eye me-2"></i>Suivi public</h1>
  <p class="text-muted small">Cette page affiche l'état d'un événement partagé.</p>
</div>
<div id="public-tree" class="vstack gap-2"></div>
{% endblock %}
{% block scripts %}
<script>
  (async () => {
    const token = new URLSearchParams(window.location.search).get('t');
    if (!token) { document.getElementById('public-tree').innerHTML = '<div class="alert alert-warning">Token manquant ?t=...</div>'; return; }
    const res = await fetch(`/p/${token}`);
    const data = await res.json();
    document.title = `Suivi · ${data.event.title}`;
    const root = document.getElementById('public-tree');
    root.innerHTML = renderNodes(data.tree);
  })();
  function renderNodes(nodes){
    return nodes.map(n => `
      <div class="border rounded-4 p-2 ${n.is_leaf && n.state==='checked' ? 'bg-success-subtle' : 'bg-white'}">
        <div class="d-flex align-items-center justify-content-between">
          <div><i class="fa-solid ${n.icon || 'fa-box'} me-2"></i>${n.name}</div>
          ${n.is_leaf ? `<span class="badge ${n.state==='checked' ? 'bg-success' : 'bg-secondary'}">${n.state}</span>` : ''}
        </div>
        ${n.children ? `<div class="ms-3 mt-2 vstack gap-2">${renderNodes(n.children)}</div>` : ''}
      </div>
    `).join('');
  }
</script>
{% endblock %}
