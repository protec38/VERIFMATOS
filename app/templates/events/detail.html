{% extends 'base.html' %}
{% block title %}Évènement{% endblock %}
{% block content %}
<h1>{{ ev.title }}</h1>
<p class="muted">Le {{ ev.date.strftime('%d/%m/%Y %H:%M') }} — {{ ev.location or '—' }}</p>
<p><a class="btn" href="{{ url_for('events.event_link', event_id=ev.id) }}">Lien pour les secouristes</a></p>

<h2>Suivi en direct</h2>
<div id="live" data-event="{{ ev.id }}">
  <div class="grid">
    {% for p in parents %}
    <div class="card" id="parent-{{ p.id }}">
      <div class="row-between">
        <h3>{{ p.name }}</h3>
        <label class="switch">
          <input type="checkbox" onchange="toggleLoaded({{ ev.id }}, {{ p.id }}, this.checked)">
          <span>Chargé</span>
        </label>
      </div>
      {% if p.children %}
      <ul class="list" id="children-{{ p.id }}">
        {% for c in p.children %}
        <li data-item="{{ c.id }}"><input type="checkbox" disabled> {{ c.name }}</li>
        {% endfor %}
      </ul>
      {% else %}
      <div class="muted">Aucun élément enfant</div>
      {% endif %}
    </div>
    {% endfor %}
  </div>
  <h3>Historique des vérifications</h3>
  <ul id="history" class="list"></ul>
</div>
<script>startLive();</script>
{% endblock %}
