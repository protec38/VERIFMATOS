{% extends 'base.html' %}
{% block title %}Évènement — {{ ev.title }}{% endblock %}
{% block content %}
<div class="header-row">
  <div>
    <h1 class="mb-0">{{ ev.title }}</h1>
    <p class="muted">Le {{ ev.date.strftime('%d/%m/%Y %H:%M') }} — {{ ev.location or '—' }}</p>
  </div>
  <div class="row gap-8">
    <a class="btn" href="{{ url_for('events.event_link', event_id=ev.id) }}"><i class="fa-solid fa-share-nodes"></i> Lien secouristes</a>
    <a class="btn" href="{{ url_for('events.export_csv', event_id=ev.id) }}"><i class="fa-solid fa-file-csv"></i> CSV</a>
    <a class="btn" href="{{ url_for('events.export_pdf', event_id=ev.id) }}"><i class="fa-solid fa-file-pdf"></i> PDF</a>
    <a class="btn" href="{{ url_for('events.edit_event', event_id=ev.id) }}"><i class="fa-solid fa-sitemap"></i> Sélection</a>
  </div>
</div>

<div id="live" data-event="{{ ev.id }}">
  <div class="grid">
  {% for parent, leaves in tree %}
    <div class="card parent-card" id="parent-{{ parent.id }}" data-parent="{{ parent.id }}">
      <div class="row-between">
        <h3 class="parent-title">{{ parent.name }}</h3>
        <label class="switch">
          <input type="checkbox" onchange="toggleLoaded({{ ev.id }}, {{ parent.id }}, this.checked)" data-loaded-for="{{ parent.id }}">
          <span>Chargé</span>
        </label>
      </div>
      <ul class="list children" id="children-{{ parent.id }}">
        {% for c in leaves %}
        <li class="child-row" data-item="{{ c.id }}">
          <label class="row-between">
            <span>
              <input type="checkbox" disabled data-checkbox="{{ c.id }}">
              <span class="child-name">{{ c.name }}</span>
              <span class="muted">×{{ c.expected_qty }}</span>
            </span>
            <span class="byline muted small">
              par <span class="who" data-who="{{ c.id }}">—</span>
              <span class="when" data-when="{{ c.id }}"></span>
            </span>
          </label>
        </li>
        {% endfor %}
      </ul>
      <div class="muted small busy" id="busy-{{ parent.id }}"></div>
    </div>
  {% endfor %}
  </div>
</div>

<script> if(typeof startLive==='function'){ startLive(1000); } </script>
{% endblock %}
