<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <title>{{ title or "Protection Civile ‚Äî Pr√©paration Mat√©riel" }}</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta name="color-scheme" content="dark">

  <!-- ===== CSS INLINE ‚Äî Th√®me Protection Civile ===== -->
  <style>
  :root{
    --pc-blue:#0E3D66;--pc-blue-2:#0b2f50;--pc-orange:#F39C12;--pc-orange-2:#f5b041;
    --bg:#0f1722;--bg-2:#121c2b;--bg-3:#0b1320;--text:#e6edf5;--muted:#95a2b3;--muted-2:#a9b8cb;
    --border:#1f2a3a;--border-2:#25344b;--success:#12b886;--danger:#ff6b6b;--warning:#f59f00;
    --shadow:0 10px 30px rgba(0,0,0,.35)
  }
  *{box-sizing:border-box}
  html,body{margin:0;padding:0;background:var(--bg);color:var(--text);
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
    -webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}

  .appbar{position:sticky;top:0;z-index:50;display:flex;align-items:center;justify-content:space-between;
    background:linear-gradient(90deg,var(--bg-2),var(--bg-3));border-bottom:1px solid var(--border);
    padding:10px 16px;box-shadow:var(--shadow)}
  .appbar .left{display:flex;align-items:center;gap:10px}
  .logo{height:22px}
  .brand{font-weight:800;color:#fff;letter-spacing:.2px}
  .brand-sub{color:var(--muted);font-weight:600}
  .appbar .right{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  .btn{display:inline-flex;align-items:center;gap:6px;padding:8px 12px;border-radius:10px;text-decoration:none;
    cursor:pointer;border:1px solid var(--border);background:#16253b;color:#cfe2ff;
    transition:transform .12s,background .12s;user-select:none}
  .btn:hover{transform:translateY(-1px);background:#1a2b46}
  .btn.primary{background:var(--pc-orange);color:#231a00;border-color:#b06c05;font-weight:800}
  .btn.ghost{background:transparent;color:#b7c7dc}
  .btn.danger{background:#5b1220;border-color:#75212f;color:#ffd5dc}
  .btn.success{background:#0f3b33;border-color:#1d6e5d;color:#bff3e7}

  .container{max-width:1160px;margin:24px auto;padding:0 12px}
  .grid{display:grid;gap:12px}.cols-2{grid-template-columns:1fr 1fr}
  @media (max-width:980px){.cols-2{grid-template-columns:1fr}}
  .card{background:radial-gradient(1200px 400px at top left,rgba(255,255,255,.03),transparent),var(--bg-2);
    border:1px solid var(--border);border-radius:14px;padding:14px;box-shadow:var(--shadow)}
  .title{font-weight:900;font-size:18px;letter-spacing:.2px}
  .subtitle{color:var(--muted);margin-top:4px}
  .row{display:flex;gap:8px;align-items:center}.wrap{flex-wrap:wrap}.space-between{justify-content:space-between}
  .table{width:100%;border-collapse:collapse}.table th,.table td{border-bottom:1px solid var(--border);
    padding:8px;text-align:left}.table th{color:#b6c7db;font-weight:800;text-transform:uppercase;
    font-size:12px;letter-spacing:.4px}.table tr:hover td{background:#101a2a}
  .muted{color:var(--muted)}
  .badge{background:#152033;color:#b8c7da;padding:4px 8px;border-radius:12px;border:1px solid var(--border);
    font-size:12px;font-weight:700}
  input,select,textarea{background:#0f1a2a;border:1px solid var(--border);color:var(--text);padding:10px 12px;
    border-radius:10px;outline:none;min-height:38px}
  input:focus,select:focus,textarea:focus{border-color:#2c4971;box-shadow:0 0 0 3px rgba(45,123,191,.15)}
  input::placeholder,textarea::placeholder{color:#74849a}
  .progress{height:10px;background:#18273f;border:1px solid var(--border);border-radius:100px;overflow:hidden}
  .progress>div{height:100%;background:linear-gradient(90deg,var(--pc-orange),var(--pc-orange-2));width:0%;transition:width .2s}
  .tree{display:flex;flex-direction:column;gap:10px}
  .node{border:1px dashed #22314a;border-radius:12px;padding:10px;background:#0e1828}
  .node .header{display:flex;justify-content:space-between;align-items:center;gap:8px}
  .node .name{font-weight:900}
  .node .qty{color:#88a4c7;font-weight:800}
  .node .childs{margin-top:8px;padding-left:12px;border-left:3px solid #1d2a40;display:flex;flex-direction:column;gap:8px}
  .item{display:flex;align-items:center;justify-content:space-between;padding:6px;gap:8px;border-radius:10px;background:#111b2a}
  .alert{padding:10px 12px;border-radius:12px;border:1px solid var(--border);background:#0e1a2b}
  .footer{text-align:center;margin:18px 0 30px;font-size:13px;color:var(--muted-2)}
  </style>
</head>
<body>
  <header class="appbar">
    <div class="left">
      <img src="/static/logo_pc.png" alt="Protection Civile" class="logo" onerror="this.style.display='none'">
      <span class="brand">Protection Civile</span>
      <span class="brand-sub">Pr√©paration Mat√©riel</span>
    </div>
    <nav class="right">
      <a class="btn" href="/dashboard">üè† Menu</a>
      {% set _cu = current_user if current_user is defined else None %}
      {% if _cu and _cu.is_authenticated and _cu.role and _cu.role.name == 'ADMIN' %}
        <!-- NAV CORRIG√âE : Stock et Administration pointent vers deux routes distinctes -->
        <a class="btn" href="/stock">üß∞ Stock</a>
        <a class="btn" href="/admin">üîß Administration</a>
      {% endif %}
      {% if _cu and _cu.is_authenticated %}
        <a class="btn ghost" href="/logout">‚á¶ D√©connexion</a>
      {% endif %}
    </nav>
  </header>

  <main class="container">
    {% block content %}{% endblock %}
  </main>

  <footer class="footer">
    {% set _now = now() if now is defined else None %}
    ¬© {{ (_now.year if _now else '‚Äî') }} Protection Civile ‚Äî Interface de pr√©paration (DPS)
  </footer>

  <!-- Client Socket.IO v4 (√©vite le mismatch) -->
  <script src="https://cdn.socket.io/4.7.5/socket.io.min.js" crossorigin="anonymous"></script>

  {% macro icon(name) -%}<span class="ico">{{ name }}</span>{%- endmacro %}
</body>
</html>
