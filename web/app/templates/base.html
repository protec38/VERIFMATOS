<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <title>{{ title or "Protection Civile ‚Äî Pr√©paration Mat√©riel" }}</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">

  <!-- CSS INLINE (th√®me Protection Civile) -->
  <style>
  :root{
    --pc-blue: #0E3D66;
    --pc-blue-2: #0b2f50;
    --pc-orange: #F39C12;
    --pc-orange-2: #f5b041;
    --bg: #0f1722;
    --bg-2: #121c2b;
    --text: #e6edf5;
    --muted: #95a2b3;
    --border: #1f2a3a;
    --shadow: 0 10px 30px rgba(0,0,0,.3);
  }
  *{ box-sizing: border-box; }
  html,body{ margin:0; padding:0; background:var(--bg); color:var(--text); font-family: ui-sans-serif,system-ui,Roboto,Arial; }

  .appbar{
    position:sticky; top:0; z-index:10;
    display:flex; align-items:center; justify-content:space-between;
    background: linear-gradient(90deg, var(--bg-2), #0d1522);
    border-bottom: 1px solid var(--border);
    padding: 10px 16px;
  }
  .appbar .left{ display:flex; align-items:center; gap:8px; }
  .logo{ height:22px; }
  .brand{ font-weight:700; color:#fff; margin-right:6px; }
  .brand-sub{ color: var(--muted); font-weight:600; }
  .appbar .right{ display:flex; gap:8px; align-items:center; }

  .container{ max-width: 1100px; margin: 24px auto; padding: 0 12px; }

  .card{
    background: radial-gradient(1200px 400px at top left, rgba(255,255,255,0.03), transparent) , var(--bg-2);
    border:1px solid var(--border);
    border-radius: 14px;
    padding: 14px;
    box-shadow: var(--shadow);
  }
  .grid{ display:grid; gap:12px; }
  .cols-2{ grid-template-columns: 1fr 1fr; }
  @media (max-width: 900px){ .cols-2{ grid-template-columns: 1fr; } }

  .row{ display:flex; gap:8px; align-items:center; }
  .title{ font-weight:800; font-size: 18px; }
  .badge{
    background: #152033; color:#b8c7da; padding:4px 8px; border-radius:12px;
    border:1px solid var(--border); font-size:12px;
  }
  .muted{ color: var(--muted); }

  .btn{
    display:inline-flex; align-items:center; gap:6px;
    padding:8px 12px; border-radius: 10px; text-decoration:none; cursor:pointer;
    border:1px solid var(--border); background:#16253b; color:#cfe2ff;
    transition: .15s ease;
  }
  .btn:hover{ transform: translateY(-1px); background:#1a2b46; }
  .btn.primary{ background: var(--pc-orange); color:#231a00; border-color: #b06c05; font-weight:700; }
  .btn.primary:hover{ filter: brightness(1.04); }
  .btn.ghost{ background: transparent; color:#b7c7dc; }
  .btn.danger{ background:#5b1220; border-color:#75212f; color:#ffd5dc; }
  .btn:disabled{ opacity:.6; cursor:not-allowed; }

  input, select{
    background:#0f1a2a; border:1px solid var(--border); color:var(--text);
    padding:8px 10px; border-radius:10px; outline:none; min-height:38px;
  }
  input::placeholder{ color:#74849a; }

  .table{ width:100%; border-collapse: collapse; }
  .table th,.table td{ border-bottom:1px solid var(--border); padding:8px; text-align:left; }
  .table th{ color:#b6c7db; font-weight:700; }
  .table tr:hover td{ background:#121d2d; }

  .footer{ text-align:center; margin:18px 0 26px; font-size:13px; }

  .progress{ height:10px; background:#18273f; border:1px solid var(--border); border-radius:100px; overflow:hidden; }
  .progress>div{ height:100%; background: linear-gradient(90deg, var(--pc-orange), var(--pc-orange-2)); width:0%; }

  .check{ display:inline-flex; align-items:center; gap:6px; }
  .check>input{ width:18px; height:18px; }

  .tree{ display:flex; flex-direction:column; gap:8px; }
  .node{ border:1px dashed #22314a; border-radius:12px; padding:8px; }
  .node .header{ display:flex; justify-content:space-between; align-items:center; gap:8px; }
  .node .name{ font-weight:700; }
  .node .qty{ color:#88a4c7; font-weight:700; }
  .node .childs{ margin-top:6px; padding-left:10px; border-left:3px solid #1d2a40; display:flex; flex-direction:column; gap:8px; }
  .item{ display:flex; align-items:center; justify-content:space-between; padding:6px; gap:8px; border-radius:10px; background:#111b2a; }
  .item .muted{ font-size:12px; }
  </style>
</head>
<body>
  <header class="appbar">
    <div class="left">
      <img src="/static/logo_pc.png" alt="Protection Civile" class="logo" onerror="this.style.display='none'">
      <span class="brand">Protection Civile</span>
      <span class="brand-sub">Pr√©paration Mat√©riel</span>
    </div>
    <nav class="right">
      <a class="btn" href="/dashboard">üè† Menu</a>
      {# ---- GUARDS : ne plante jamais si current_user n'est pas inject√© ---- #}
      {% set _cu = current_user if current_user is defined else None %}
      {% if _cu and _cu.is_authenticated and _cu.role and _cu.role.name == 'ADMIN' %}
        <a class="btn" href="/manage">üß∞ Stock</a>
        <a class="btn" href="/admin">üîß Administration</a>
      {% endif %}
      {% if _cu and _cu.is_authenticated %}
        <a class="btn ghost" href="/logout">‚á¶ D√©connexion</a>
      {% endif %}
    </nav>
  </header>

  <main class="container">
    {% block content %}{% endblock %}
  </main>

  <footer class="footer muted">
    {% set _now = now() if now is defined else None %}
    ¬© {{ (_now.year if _now else '‚Äî') }} Protection Civile ‚Äî Interface de pr√©paration (DPS)
  </footer>

  <!-- Socket.IO (si dispo c√¥t√© serveur) -->
  <script src="/socket.io/socket.io.js"></script>

  {# Place le macro ici (aucune variable utilis√©e pour √©viter les erreurs au moment des imports) #}
  {% macro icon(name) -%}
    <span class="ico">{{ name }}</span>
  {%- endmacro %}
</body>
</html>
