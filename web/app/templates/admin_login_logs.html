{% extends "base.html" %}
{% set title = "Administration — Connexions" %}
{% block content %}
  

  <div class="logs-page">
    <section class="logs-hero">
      <div class="title">Historique des connexions</div>
      <p class="subtitle">Surveille les accès récents à l’interface : chaque tentative est enregistrée avec le résultat, l’adresse IP et le message renvoyé.</p>
      <div class="hero-actions">
        <a class="btn" href="/admin">⬅ Retour administration</a>
      </div>
    </section>

    <section class="logs-table-card">
      <div class="title">Derniers accès</div>
      <p class="subtitle">Affiche jusqu’à 200 lignes pour faciliter les audits de sécurité.</p>
      {% if logs %}
        <div class="table-scroll">
          <div class="logs-table-wrapper">
            <table>
              <thead>
                <tr>
                  <th>Date</th>
                  <th>Utilisateur</th>
                  <th>Adresse IP</th>
                  <th>Statut</th>
                  <th>Message</th>
                </tr>
              </thead>
              <tbody>
                {% for log in logs %}
                  {% set meta = log.meta or {} %}
                  {% set status = meta.get('status') or (log.action.split('.')[-1] if log.action else '') %}
                  {% if status == 'success' %}
                    {% set pill_state = 'success' %}
                    {% set status_label = 'Succès' %}
                  {% else %}
                    {% set pill_state = 'error' %}
                    {% set status_label = 'Échec' %}
                  {% endif %}
                  <tr>
                    <td>{{ log.ts.strftime('%d/%m/%Y %H:%M') if log.ts else '—' }}</td>
                    <td>{{ meta.get('username') or (log.user.username if log.user else 'Inconnu') }}</td>
                    <td>{{ meta.get('client_ip') or '—' }}</td>
                    <td><span class="status-pill" data-state="{{ pill_state }}">{{ status_label }}</span></td>
                    <td>{{ meta.get('message') or '—' }}</td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      {% else %}
        <div class="empty-state">Aucune connexion enregistrée pour le moment.</div>
      {% endif %}
    </section>
  </div>
{% endblock %}
